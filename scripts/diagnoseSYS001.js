#!/usr/bin/env node

/**
 * Diagnose SYS_001 Error
 * 
 * This script helps diagnose the specific cause of SYS_001 errors
 */

console.log('üîç Diagn√≥stico Espec√≠fico do Erro SYS_001\n');

console.log('üìã AN√ÅLISE DOS LOGS FIREBASE:');
console.log('');
console.log('‚ùå Erros encontrados nos logs:');
console.log('   ‚Ä¢ "Request has invalid method. GET"');
console.log('   ‚Ä¢ "Invalid request, unable to process"');
console.log('   ‚Ä¢ Fun√ß√µes Firebase recebendo GET em vez de POST');
console.log('');

console.log('üîç POSS√çVEIS CAUSAS:');
console.log('');

console.log('1Ô∏è‚É£ Requisi√ß√µes GET para Firebase Functions:');
console.log('   ‚Ä¢ Navegador fazendo preflight requests');
console.log('   ‚Ä¢ Extens√µes do navegador fazendo requests');
console.log('   ‚Ä¢ Bots ou crawlers acessando URLs');
console.log('   ‚Ä¢ Configura√ß√£o incorreta de CORS');
console.log('');

console.log('2Ô∏è‚É£ Problemas de Frontend:');
console.log('   ‚Ä¢ C√≥digo fazendo requisi√ß√µes GET por engano');
console.log('   ‚Ä¢ Configura√ß√£o incorreta do apiClient');
console.log('   ‚Ä¢ Problemas no firebaseService');
console.log('   ‚Ä¢ Cache do navegador com requisi√ß√µes antigas');
console.log('');

console.log('3Ô∏è‚É£ Problemas de Configura√ß√£o:');
console.log('   ‚Ä¢ Firebase Functions mal configuradas');
console.log('   ‚Ä¢ CORS n√£o configurado corretamente');
console.log('   ‚Ä¢ Middleware de autentica√ß√£o com problemas');
console.log('');

console.log('üí° SOLU√á√ïES PARA TESTAR:');
console.log('');

console.log('üîÑ Limpeza Completa:');
console.log('   1. Limpar cache do navegador (Ctrl+Shift+R)');
console.log('   2. Limpar localStorage e sessionStorage');
console.log('   3. Testar em modo inc√≥gnito');
console.log('   4. Testar em outro navegador');
console.log('');

console.log('üîß Debug no Navegador:');
console.log('   1. Abrir Developer Tools (F12)');
console.log('   2. Ir para aba Network');
console.log('   3. Limpar network log');
console.log('   4. Reproduzir o erro');
console.log('   5. Procurar por requisi√ß√µes GET para Firebase Functions');
console.log('');

console.log('üì± Comandos de Debug:');
console.log('   // No console do navegador:');
console.log('   debugSYS001.showErrorLogs()');
console.log('   debugSYS001.testFirebase()');
console.log('   debugSYS001.clearErrorLogs()');
console.log('');

console.log('üö® A√á√ïES IMEDIATAS:');
console.log('');

console.log('1. Verificar se h√° requisi√ß√µes GET nas fun√ß√µes:');
console.log('   ‚Ä¢ Abrir aba Network no DevTools');
console.log('   ‚Ä¢ Procurar por requests para:');
console.log('     - validateAdminInitialization');
console.log('     - initializeDefaultAdmin');
console.log('     - Outras fun√ß√µes Firebase');
console.log('   ‚Ä¢ Verificar se o m√©todo √© POST (correto) ou GET (erro)');
console.log('');

console.log('2. Verificar c√≥digo do frontend:');
console.log('   ‚Ä¢ Procurar por fetch() ou axios.get() para Firebase Functions');
console.log('   ‚Ä¢ Verificar se firebaseService est√° usando POST');
console.log('   ‚Ä¢ Verificar se n√£o h√° c√≥digo fazendo GET por engano');
console.log('');

console.log('3. Testar isoladamente:');
console.log('   ‚Ä¢ Testar login sem outras a√ß√µes');
console.log('   ‚Ä¢ Testar em p√°gina limpa');
console.log('   ‚Ä¢ Verificar se erro ocorre sempre ou esporadicamente');
console.log('');

console.log('üìä INFORMA√á√ïES PARA COLETA:');
console.log('');
console.log('Se o problema persistir, colete:');
console.log('   ‚Ä¢ Screenshot da aba Network mostrando requisi√ß√µes');
console.log('   ‚Ä¢ Logs do console do navegador');
console.log('   ‚Ä¢ Hor√°rio exato do erro');
console.log('   ‚Ä¢ A√ß√£o espec√≠fica que causa o erro');
console.log('   ‚Ä¢ Navegador e vers√£o');
console.log('');

console.log('üîß COMANDOS √öTEIS:');
console.log('');
console.log('# Ver logs Firebase em tempo real:');
console.log('firebase functions:log --project curva-mestra --follow');
console.log('');
console.log('# Testar fun√ß√µes diretamente:');
console.log('node scripts/testAPIClient.js no-auth');
console.log('');
console.log('# Verificar configura√ß√£o Firebase:');
console.log('node scripts/testFirebaseInit.js');
console.log('');

console.log('‚úÖ Execute estes passos e documente os resultados.');
console.log('üåê Aplica√ß√£o: https://curva-mestra.web.app');
console.log('üåê Local: http://localhost:3000');